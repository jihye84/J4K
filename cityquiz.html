<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ë„ì‹œ ì§€ëª… ë§ˆìŠ¤í„° ğŸ™ï¸</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ™ï¸</text></svg>">
    <link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic:wght@400;700&family=Nanum+Pen+Script&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-gradient: linear-gradient(135deg, #fdfcfb 0%, #e2d1c3 100%);
            --card-bg: rgba(255, 255, 255, 0.95);
            --primary: #8e9eab;
            --accent: #ffb7b2;
            --text-color: #4a4a4a;
            --btn-bg: #ffffff;
            --btn-shadow: #d1d1d1;
        }

        body { 
            font-family: 'Nanum Gothic', sans-serif; 
            background: var(--bg-gradient); 
            color: var(--text-color);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            margin: 0; padding: 0; height: 100vh; overflow: hidden;
            touch-action: manipulation;
        }

        .home-btn {
            position: absolute; top: 15px; right: 15px;
            text-decoration: none; font-size: 24px;
            background: #fff; width: 45px; height: 45px;
            display: flex; align-items: center; justify-content: center;
            border-radius: 50%; box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            z-index: 100;
        }

        #game-container { 
            background: var(--card-bg); 
            padding: 15px; border-radius: 35px; 
            box-shadow: 0 15px 35px rgba(0,0,0,0.1); 
            width: 90%; max-width: 420px; 
            height: 90vh;
            display: flex; flex-direction: column; 
            border: 6px solid #fff; box-sizing: border-box;
            position: relative; text-align: center;
        }

        .header { flex-shrink: 0; margin-bottom: 5px; }
        .mode-badge {
            display: inline-block; padding: 5px 16px; border-radius: 50px;
            font-size: 12px; font-weight: bold; margin-bottom: 5px;
            color: white; background: var(--primary);
        }

        #word-display { 
            font-family: 'serif'; font-size: 8vh; font-weight: bold;
            color: #333; flex-grow: 1;
            display: flex; align-items: center; justify-content: center;
        }

        /* í”¼ë“œë°± ì˜ì—­ ê³ ì • ë° ê²¹ì¹¨ ë°©ì§€ */
        #feedback-area {
            min-height: 140px; 
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            flex-shrink: 0; padding: 5px;
        }
        #feedback { 
            font-family: 'Nanum Pen Script', cursive; font-size: 22px;
            text-align: center; word-break: keep-all; line-height: 1.3;
            margin-bottom: 10px;
        }
        .correct { color: #5dade2; }
        .incorrect { color: #ec7063; }

        #next-btn {
            background: #ffdac1; font-size: 15px; padding: 10px 30px;
            border-radius: 50px; box-shadow: 0 4px 0px #e5c2ac;
            color: #8a6d5a; font-weight: bold; border: none; cursor: pointer;
            visibility: hidden;
        }

        .options-grid { 
            display: grid; gap: 10px; 
            grid-template-columns: repeat(2, 1fr);
            flex-shrink: 0; padding: 5px; margin-bottom: 15px;
        }
        
        button.option-btn { 
            font-family: 'Nanum Gothic', sans-serif;
            padding: 12px 5px; font-size: 18px; cursor: pointer; 
            border: none; border-radius: 18px; 
            background: var(--btn-bg); color: var(--text-color);
            box-shadow: 0 5px 0px var(--btn-shadow);
            transition: all 0.1s;
        }
        button.option-btn:active:not(:disabled) { transform: translateY(2px); box-shadow: none; }
        button.option-btn:disabled { opacity: 0.6; }

        #score-display { 
            font-size: 12px; color: #aaa;
            background: #fff; padding: 10px; border-radius: 15px;
            display: flex; justify-content: space-around;
            border: 1px solid #f0f0f0; flex-shrink: 0;
        }

        .result-screen { display: none; height: 100%; flex-direction: column; justify-content: center; align-items: center; }
        .btn-action { color: white; font-weight: bold; margin-top: 10px; width: 100%; padding: 16px; border-radius: 20px; border: none; cursor: pointer; font-size: 17px; }
    </style>
</head>
<body>

    <a href="index.html" class="home-btn">ğŸ </a>

    <div id="game-container">
        <div id="quiz-screen" style="height: 100%; display: flex; flex-direction: column;">
            <div class="header">
                <div id="mode-indicator" class="mode-badge">ë„ì‹œ ì§€ëª… ë§ˆìŠ¤í„° ğŸ™ï¸</div>
                <div style="font-size: 11px; color: #bbb;">ë³´ê¸°: 
                    <select id="option-count" style="padding: 2px; font-size: 11px;">
                        <option value="2">2ê°œ</option>
                        <option value="4" selected>4ê°œ</option>
                        <option value="6">6ê°œ</option>
                    </select>
                </div>
            </div>

            <div id="word-display">...</div>

            <div id="feedback-area">
                <div id="feedback"></div>
                <button id="next-btn" onclick="goToNextQuestion()">ë‹¤ìŒ ë¬¸ì œ â¯</button>
            </div>

            <div id="options" class="options-grid"></div>
            
            <div id="score-display">
                <span>ğŸ“ <span id="current-q-num">1</span>/10</span>
                <span>â­ <span id="correct-q-num">0</span></span>
            </div>
        </div>

        <div id="result-screen" class="result-screen">
            <span style="font-size: 50px;">ğŸ—ºï¸</span>
            <h2 id="result-title">ì „êµ­ íˆ¬ì–´ ì™„ë£Œ!</h2>
            <p id="result-stats" style="font-size: 20px; color: #888;"></p>
            <button onclick="startGame()" class="btn-action" style="background:var(--primary);">âœ¨ ìƒˆë¡œìš´ 10ë¬¸ì œ</button>
            <button id="retry-failed-btn" onclick="startRetryMode()" class="btn-action" style="background:var(--accent);">ğŸ” ì˜¤ë‹µ ë³µìŠµí•˜ê¸°</button>
        </div>
    </div>

<script>
    const cityData = [
        {k: "æ±äº¬", h: "ã¨ã†ãã‚‡ã†", n: "ë„ì¿„", i: "æ±(ë™ìª½) + äº¬(ìˆ˜ë„)", r: "ì¼ë³¸ì˜ í˜„ì¬ ìˆ˜ë„ì…ë‹ˆë‹¤."},
        {k: "å¤§é˜ª", h: "ãŠãŠã•ã‹", n: "ì˜¤ì‚¬ì¹´", i: "å¤§(í°) + é˜ª(ì–¸ë•)", r: "'é˜ª'ì€ ì§€ëª… ì „ìš© í•œìì˜ˆìš”."},
        {k: "äº¬éƒ½", h: "ãã‚‡ã†ã¨", n: "êµí† ", i: "äº¬(ìˆ˜ë„) + éƒ½(ë„ì‹œ)", r: "ì²œë…„ì˜ ê³ ë„, ìˆ˜ë„ë¼ëŠ” ëœ»ì…ë‹ˆë‹¤."},
        {k: "åå¤å±‹", h: "ë‚˜ã”ã‚„", n: "ë‚˜ê³ ì•¼", i: "å(ì´ë¦„) + å¤(ì˜›) + å±‹(ì§‘)", r: "å±‹(ì•¼)ëŠ” ì§‘ì„ ëœ»í•˜ëŠ” í›ˆë…ì…ë‹ˆë‹¤."},
        {k: "ç¦å²¡", h: "ãµããŠã‹", n: "í›„ì¿ ì˜¤ì¹´", i: "ç¦(ë³µ) + å²¡(ì–¸ë•)", r: "ë³µì´ ìˆëŠ” ì–¸ë•ì´ë¼ëŠ” ëœ»ì…ë‹ˆë‹¤."},
        {k: "æ¨ªæµœ", h: "ã‚ˆã“ã¯ë§ˆ", n: "ìš”ì½”í•˜ë§ˆ", i: "æ¨ª(ì˜†) + æµœ(í•´ë³€)", r: "ì˜†ìœ¼ë¡œ ê¸´ í•´ë³€ì´ë¼ëŠ” ëœ»ì…ë‹ˆë‹¤."},
        {k: "ç¥æˆ¸", h: "ã“ã†ã¹", n: "ê³ ë² ", i: "ç¥(ì‹ ) + æˆ¸(ë¬¸)", r: "íŠ¹ìˆ˜ì½ê¸°: 'ì‹ 'ì„ 'ì½”ìš°'ë¡œ ì½ìŠµë‹ˆë‹¤."},
        {k: "åºƒå³¶", h: "ã²ã‚ã—ã¾", n: "íˆë¡œì‹œë§ˆ", i: "åºƒ(ë„“ì€) + å³¶(ì„¬)", r: "ë„“ì€ ì„¬ì´ë¼ëŠ” í‰ë²”í•œ í›ˆë… ì¡°í•©ì…ë‹ˆë‹¤."},
        {k: "ä»™å°", h: "ã›ã‚“ã ã„", n: "ì„¼ë‹¤ì´", i: "ä»™(ì‹ ì„ ) + å°(ëŒ€)", r: "ì‹ ì„ ì´ ì‚¬ëŠ” ì–¸ë•ì´ë¼ëŠ” ëœ»ì…ë‹ˆë‹¤."},
        {k: "æœ­å¹Œ", h: "ã•ã£ã½ã‚", n: "ì‚¿í¬ë¡œ", i: "æœ­(íŒ¨) + å¹Œ(íœ˜ì¥)", r: "ì•„ì´ëˆ„ì–´ ë°œìŒì„ í•œìë¡œ ë¹Œë ¤ì™”ìŠµë‹ˆë‹¤."},
        {k: "é•·å´", h: "ãªãŒã•ã", n: "ë‚˜ê°€ì‚¬í‚¤", i: "é•·(ê¸´) + å´(ê³¶/ì‚°ë)", r: "å´(ì‚¬í‚¤)ëŠ” ì§€ëª…ì— ì•„ì£¼ ìì£¼ ì“°ì—¬ìš”."},
        {k: "é‡‘æ²¢", h: "ã‹ãªã–ã‚", n: "ì¹´ë‚˜ìì™€", i: "é‡‘(ê¸ˆ) + æ²¢(ëª»/ëŠª)", r: "æ²¢(ì‚¬ì™€)ê°€ 'ìì™€'ë¡œ íƒìŒí™”ë˜ì—ˆìŠµë‹ˆë‹¤."},
        {k: "é¹¿å…å³¶", h: "ã‹ã”ã—ã¾", n: "ì¹´ê³ ì‹œë§ˆ", i: "é¹¿(ì‚¬ìŠ´) + å…(ì•„ì´) + å³¶(ì„¬)", r: "ì‚¬ìŠ´ ìƒˆë¼ì˜ ì„¬ì´ë¼ëŠ” ëœ»ì…ë‹ˆë‹¤."},
        {k: "é™å²¡", h: "ã—ãšãŠã‹", n: "ì‹œì¦ˆì˜¤ì¹´", i: "é™(ê³ ìš”) + å²¡(ì–¸ë•)", r: "ê³ ìš”í•œ ì–¸ë•ì´ë¼ëŠ” ëœ»ì…ë‹ˆë‹¤."},
        {k: "å²¡å±±", h: "ãŠã‹ã‚„ã¾", n: "ì˜¤ì¹´ì•¼ë§ˆ", i: "å²¡(ì–¸ë•) + å±±(ì‚°)", r: "ì–¸ë•ê³¼ ì‚°ì˜ ì¡°í•©ì…ë‹ˆë‹¤."},
        {k: "ç†Šæœ¬", h: "ãã¾ã‚‚ã¨", n: "ì¿ ë§ˆëª¨í† ", i: "ç†Š(ê³°) + æœ¬(ê·¼ë³¸)", r: "ê°•í•´ ë³´ì´ê¸° ìœ„í•´ 'ê³°'ìë¥¼ ì¼ìŠµë‹ˆë‹¤."},
        {k: "å¥ˆè‰¯", h: "ãªã‚‰", n: "ë‚˜ë¼", i: "å¥ˆ(ì–´ì°Œ) + è‰¯(ì–´ì§ˆë‹¤)", r: "ë°œìŒì„ ë¹Œë ¤ì˜¨ ì•„í…Œì§€ì…ë‹ˆë‹¤."},
        {k: "æ–°æ½Ÿ", h: "ã«ã„ãŒãŸ", n: "ë‹ˆì´ê°€íƒ€", i: "æ–°(ìƒˆë¡œìš´) + æ½Ÿ(ê°¯ë²Œ)", r: "æ½Ÿ(ê°€íƒ€)ëŠ” ê°¯ë²Œ/ì„í˜¸ë¥¼ ëœ»í•©ë‹ˆë‹¤."},
        {k: "æ¾å±±", h: "ã¾ã¤ã‚„ã¾", n: "ë§ˆì¸ ì•¼ë§ˆ", i: "æ¾(ì†Œë‚˜ë¬´) + å±±(ì‚°)", r: "ì†Œë‚˜ë¬´ê°€ ë§ì€ ì‚°ì´ë¼ëŠ” ëœ»ì…ë‹ˆë‹¤."},
        {k: "é«˜æ¾", h: "ãŸã‹ã¾ã¤", n: "íƒ€ì¹´ë§ˆì¸ ", i: "é«˜(ë†’ì€) + æ¾(ì†Œë‚˜ë¬´)", r: "í‚¤ í° ì†Œë‚˜ë¬´ë¼ëŠ” ëœ»ì…ë‹ˆë‹¤."}
    ];

    let currentQuizSet = [], currentIdx = 0, correctCount = 0, failedQuestions = [], isReviewMode = false;

    // ìƒ¤ë¼ë¼~ ë”©ë™ëŒ• íš¨ê³¼ìŒ
    function playSound(isCorrect) {
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        const masterGain = audioCtx.createGain();
        masterGain.connect(audioCtx.destination);
        masterGain.gain.setValueAtTime(0.05, audioCtx.currentTime); 

        if (isCorrect) {
            const notes = [523.25, 659.25, 783.99, 1046.50]; 
            notes.forEach((freq, i) => {
                const osc = audioCtx.createOscillator();
                const g = audioCtx.createGain();
                osc.type = 'sine';
                osc.frequency.setValueAtTime(freq, audioCtx.currentTime + i * 0.1);
                g.gain.setValueAtTime(0, audioCtx.currentTime + i * 0.1);
                g.gain.linearRampToValueAtTime(0.2, audioCtx.currentTime + i * 0.1 + 0.05);
                g.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + i * 0.1 + 0.5);
                osc.connect(g);
                g.connect(masterGain);
                osc.start(audioCtx.currentTime + i * 0.1);
                osc.stop(audioCtx.currentTime + i * 0.1 + 0.6);
            });
        }
    }

    function speak(text) {
        window.speechSynthesis.cancel();
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = 'ja-JP';
        window.speechSynthesis.speak(utterance);
    }

    function startGame() {
        isReviewMode = false; failedQuestions = [];
        currentQuizSet = [...cityData].sort(() => Math.random() - 0.5).slice(0, 10);
        resetState();
    }

    function startRetryMode() {
        isReviewMode = true;
        currentQuizSet = [...failedQuestions].sort(() => Math.random() - 0.5);
        failedQuestions = []; 
        resetState();
    }

    function resetState() {
        currentIdx = 0; correctCount = 0;
        document.getElementById('mode-indicator').innerText = isReviewMode ? "ì§€ëª… ë³µìŠµ ğŸ”" : "ë„ì‹œ ì§€ëª… ë§ˆìŠ¤í„° ğŸ™ï¸";
        document.getElementById('quiz-screen').style.display = 'flex';
        document.getElementById('result-screen').style.display = 'none';
        hideFeedback();
        renderQuestion();
    }

    function hideFeedback() {
        document.getElementById('feedback').innerText = "";
        document.getElementById('next-btn').style.visibility = 'hidden';
    }

    function renderQuestion() {
        if (currentIdx >= currentQuizSet.length) { showResult(); return; }
        const q = currentQuizSet[currentIdx];
        const numOptions = parseInt(document.getElementById('option-count').value);
        
        document.getElementById('word-display').innerText = q.h;
        document.getElementById('current-q-num').innerText = currentIdx + 1;
        document.getElementById('correct-q-num').innerText = correctCount;

        let options = [q.k];
        let others = cityData.filter(item => item.k !== q.k).sort(() => Math.random() - 0.5);
        for(let i=0; i < numOptions - 1; i++) { if(others[i]) options.push(others[i].k); }
        options.sort(() => Math.random() - 0.5);

        const optionsDiv = document.getElementById('options');
        optionsDiv.innerHTML = "";
        options.forEach(opt => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.innerText = opt;
            btn.onclick = () => checkAnswer(opt, q);
            optionsDiv.appendChild(btn);
        });
    }

    function checkAnswer(selected, qObj) {
        const allBtns = document.querySelectorAll('#options button');
        allBtns.forEach(b => b.disabled = true);

        const feedback = document.getElementById('feedback');
        if (selected === qObj.k) {
            playSound(true);
            feedback.innerHTML = `<span class="correct">ì •ë‹µ! ì´ê³³ì€ <strong>${qObj.n}</strong>ì…ë‹ˆë‹¤.<br>${qObj.i}<br>ğŸ’¡ ${qObj.r}</span>`;
            correctCount++;
        } else {
            feedback.innerHTML = `<span class="incorrect">ì•„ì‰¬ì›Œìš”! ì •ë‹µì€ <strong>${qObj.k}</strong>ì…ë‹ˆë‹¤.<br>${qObj.n}: ${qObj.i}</span>`;
            if (!failedQuestions.some(item => item.k === qObj.k)) failedQuestions.push(qObj);
        }
        
        setTimeout(() => speak(qObj.h), 300);
        document.getElementById('next-btn').style.visibility = 'visible';
    }

    function goToNextQuestion() {
        currentIdx++;
        hideFeedback();
        renderQuestion();
    }

    function showResult() {
        document.getElementById('quiz-screen').style.display = 'none';
        document.getElementById('result-screen').style.display = 'flex';
        document.getElementById('result-stats').innerText = `${currentQuizSet.length}ë¬¸ì œ ì¤‘ ${correctCount}ê°œ ì„±ê³µ!`;
        document.getElementById('retry-failed-btn').style.display = failedQuestions.length > 0 ? 'block' : 'none';
    }

    window.onload = startGame;
</script>
</body>
</html>