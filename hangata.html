<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ê°€íƒ€ì¹´ë‚˜ ì°¾ê¸° ğŸ”¡</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ”¡</text></svg>">
    <link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic:wght@400;700&family=Nanum+Pen+Script&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-color: #fdf6f0;
            --card-bg: #ffffff;
            --primary: #ffdac1;
            --accent: #ffb7b2;
            --text-color: #5d5d5d;
            --btn-bg: #f8f9fa;
        }

        body { 
            font-family: 'Nanum Gothic', sans-serif; 
            background-color: var(--bg-color); 
            color: var(--text-color);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            margin: 0; padding: 0; 
            height: 100vh;
            overflow: hidden;
            touch-action: manipulation;
        }

        .home-btn {
            position: absolute; top: 15px; right: 15px;
            text-decoration: none; font-size: 24px;
            background: #fff; width: 45px; height: 45px;
            display: flex; align-items: center; justify-content: center;
            border-radius: 50%; box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            z-index: 100;
        }

        #game-container { 
            background: var(--card-bg); 
            padding: 20px; border-radius: 35px; 
            box-shadow: 0 15px 35px rgba(0,0,0,0.03); 
            width: 90%; max-width: 420px; 
            height: 85vh;
            display: flex; flex-direction: column; justify-content: space-between;
            text-align: center; border: 6px solid #fff; box-sizing: border-box;
            position: relative;
        }

        .header { flex-shrink: 0; }
        .mode-badge {
            display: inline-block; padding: 5px 16px; border-radius: 50px;
            font-size: 12px; font-weight: bold; margin-bottom: 5px;
            color: white; background: var(--primary);
        }

        #word-display { 
            font-family: 'Nanum Pen Script', cursive; 
            font-size: 10vh;
            font-weight: 400; color: #444; 
            flex-grow: 1; display: flex; align-items: center; justify-content: center;
        }

        #feedback-area {
            min-height: 120px; 
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            flex-shrink: 0; padding: 5px;
        }
        #feedback { 
            font-family: 'Nanum Pen Script', cursive; font-size: 24px;
            text-align: center; word-break: keep-all; line-height: 1.3;
            margin-bottom: 10px;
        }
        .correct { color: #2980b9; }
        .incorrect { color: #c0392b; }

        #next-btn {
            background: #ffdac1; font-size: 15px; padding: 10px 30px;
            border-radius: 50px; box-shadow: 0 4px 0px #e5c2ac;
            color: #8a6d5a; font-weight: bold; border: none; cursor: pointer;
            visibility: hidden;
        }

        .options-grid { 
            display: grid; gap: 10px; 
            grid-template-columns: repeat(2, 1fr);
            flex-shrink: 0; padding: 5px; margin-bottom: 15px;
        }
        
        button.option-btn { 
            font-family: 'Nanum Gothic', sans-serif;
            padding: 12px 5px; font-size: 18px; cursor: pointer; 
            border: none; border-radius: 18px; 
            background: var(--btn-bg); color: var(--text-color);
            box-shadow: 0 4px 0px #eee; transition: all 0.1s;
        }
        button.option-btn:active:not(:disabled) { transform: translateY(2px); box-shadow: none; }
        button.option-btn:disabled { opacity: 0.6; }

        #score-display { 
            font-size: 12px; color: #aaa;
            background: #fff; padding: 10px; border-radius: 15px;
            display: flex; justify-content: space-around;
            border: 1px solid #f0f0f0; flex-shrink: 0;
        }

        .result-screen { display: none; height: 100%; flex-direction: column; justify-content: center; align-items: center; }
    </style>
</head>
<body>

    <a href="index.html" class="home-btn">ğŸ </a>

    <div id="game-container">
        <div id="quiz-screen" style="height:100%; display:flex; flex-direction:column;">
            <div class="header">
                <div id="mode-indicator" class="mode-badge">í•™ìŠµ ëª¨ë“œ âœ¨</div>
                <div style="font-size: 11px; color: #bbb;">ë³´ê¸°: 
                    <select id="option-count" style="padding: 2px; font-size: 11px;">
                        <option value="2">2ê°œ</option>
                        <option value="4" selected>4ê°œ</option>
                        <option value="6">6ê°œ</option>
                    </select>
                </div>
            </div>
            
            <div id="word-display">...</div>
            
            <div id="feedback-area">
                <div id="feedback"></div>
                <button id="next-btn" onclick="goToNextQuestion()">ë‹¤ìŒ ë¬¸ì œ â¯</button>
            </div>

            <div id="options" class="options-grid"></div>
            
            <div id="score-display">
                <span>ğŸ“ <span id="current-q-num">1</span>/10</span>
                <span>â­ <span id="correct-q-num">0</span></span>
            </div>
        </div>

        <div id="result-screen" class="result-screen">
            <span style="font-size: 50px;">ğŸ‰</span>
            <h2 id="result-title">ìˆ˜ê³ í•˜ì…¨ì–´ìš”!</h2>
            <p id="result-stats" style="font-size: 20px; color: #777; margin: 10px 0;"></p>
            <button onclick="startGame()" style="color:white; font-weight:bold; margin-top:10px; width:100%; padding:16px; border-radius:20px; border:none; background:#a7c7e7;">âœ¨ ìƒˆë¡œìš´ 10ë¬¸ì œ</button>
            <button id="retry-failed-btn" onclick="startRetryMode()" style="color:white; font-weight:bold; margin-top:10px; width:100%; padding:16px; border-radius:20px; border:none; background:var(--accent);">ğŸ” í‹€ë¦° ë¬¸ì œ ë³µìŠµí•˜ê¸°</button>
        </div>
    </div>

<script>
    // [ìˆ˜ì • ì™„ë£Œ] ë°ì´í„° ë‚´ í•œê¸€ ì˜¤íƒ€(ë°ì´í„°, ì‚¬ì´íŠ¸ ë“±)ë¥¼ ê°€íƒ€ì¹´ë‚˜ë¡œ ëª¨ë‘ ê³ ì³¤ìŠµë‹ˆë‹¤.
    const originalData = [
        {k: "ã‚¢ã‚¤ã‚¹ã‚¯ãƒªãƒ¼ãƒ ", m: "ì•„ì´ìŠ¤í¬ë¦¼"}, {k: "ãƒ“ãƒ¼ãƒ«", m: "ë§¥ì£¼"}, {k: "ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ¼", m: "ì»´í“¨í„°"}, {k: "ã‚µãƒ³ãƒ‰ã‚¤ãƒƒãƒ", m: "ìƒŒë“œìœ„ì¹˜"},
        {k: "ã‚³ãƒ¼ãƒ’ãƒ¼", m: "ì»¤í”¼"}, {k: "ã‚³ãƒ¼ãƒ©", m: "ì½œë¼"}, {k: "ãƒ†ãƒ¬ãƒ“", m: "í…”ë ˆë¹„ì „"}, {k: "ãƒ©ã‚¸ã‚ª", m: "ë¼ë””ì˜¤"},
        {k: "ã‚«ãƒ¡ãƒ©", m: "ì¹´ë©”ë¼"}, {k: "ãƒ”ã‚¢ãƒ", m: "í”¼ì•„ë…¸"}, {k: "ã‚®ã‚¿ãƒ¼", m: "ê¸°íƒ€"}, {k: "ãƒã‚¹", m: "ë²„ìŠ¤"},
        {k: "ã‚¿ã‚¯ã‚·ãƒ¼", m: "íƒì‹œ"}, {k: "ãƒ›ãƒ†ãƒ«", m: "í˜¸í…”"}, {k: "ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³", m: "ë ˆìŠ¤í† ë‘"}, {k: "ãƒ¡ãƒ‹ãƒ¥ãƒ¼", m: "ë©”ë‰´"},
        {k: "ãƒ‘ãƒ³", m: "ë¹µ"}, {k: "ãƒˆã‚¤ãƒ¬", m: "í™”ì¥ì‹¤"}, {k: "ãƒ‹ãƒ¥ãƒ¼ã‚¹", m: "ë‰´ìŠ¤"}, {k: "ãƒãƒ¼ãƒˆ", m: "ë…¸íŠ¸"},
        {k: "ãƒšãƒ³", m: "íœ"}, {k: "ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆ", m: "ì„ ë¬¼"}, {k: "ã‚±ãƒ¼ã‚­", m: "ì¼€ì´í¬"}, {k: "ã‚µãƒ©ãƒ€", m: "ìƒëŸ¬ë“œ"},
        {k: "ãƒãƒ¼ã‚º", m: "ì¹˜ì¦ˆ"}, {k: "ãƒãƒ§ã‚³", m: "ì´ˆì½”"}, {k: "ãƒãƒŠãƒŠ", m: "ë°”ë‚˜ë‚˜"}, {k: "ã‚ªãƒ¬ãƒ³ã‚¸", m: "ì˜¤ë Œì§€"},
        {k: "ã‚¢ãƒƒãƒ—ãƒ«", m: "ì• í”Œ"}, {k: "ãƒŸãƒ«ã‚¯", m: "ë°€í¬"}, {k: "ã‚¯ãƒ©ã‚¹", m: "í´ë˜ìŠ¤"}, {k: "ãƒ†ã‚¹ãƒˆ", m: "í…ŒìŠ¤íŠ¸"},
        {k: "ãƒ†ãƒ‹ã‚¹", m: "í…Œë‹ˆìŠ¤"}, {k: "ã‚µãƒƒã‚«ãƒ¼", m: "ì‚¬ì»¤"}, {k: "ã‚¹ã‚­ãƒ¼", m: "ìŠ¤í‚¤"}, {k: "ãƒ€ãƒ³ã‚¹", m: "ëŒ„ìŠ¤"},
        {k: "ãƒ‰ãƒ©ãƒ", m: "ë“œë¼ë§ˆ"}, {k: "ã‚¢ãƒ‹ãƒ¡", m: "ì• ë‹ˆë©”ì´ì…˜"}, {k: "ã‚²ãƒ¼ãƒ ", m: "ê²Œì„"}, {k: "ã‚µã‚¤ãƒˆ", m: "ì‚¬ì´íŠ¸"},
        {k: "ã‚¹ãƒãƒ›", m: "ìŠ¤ë§ˆíŠ¸í°"}, {k: "ã‚¢ãƒ—ãƒª", m: "ì•±"}, {k: "ãƒ‘ã‚½ã‚³ãƒ³", m: "PC"}, {k: "ãƒã‚¦ã‚¹", m: "ë§ˆìš°ìŠ¤"},
        {k: "ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰", m: "í‚¤ë³´ë“œ"}, {k: "ãƒ¢ãƒ‹ã‚¿ãƒ¼", m: "ëª¨ë‹ˆí„°"}, {k: "ãƒšãƒ¼ã‚¸", m: "í˜ì´ì§€"}, {k: "ã‚³ãƒ”ãƒ¼", m: "ì¹´í”¼"},
        {k: "ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼", m: "ìº˜ë¦°ë”"}, {k: "ãƒ™ãƒƒãƒ‰", m: "ì¹¨ëŒ€"}, {k: "ã‚½ãƒ•ã‚¡", m: "ì†ŒíŒŒ"}, {k: "ãƒ‰ã‚¢", m: "ë„ì–´"},
        {k: "ã‚³ãƒƒãƒ—", m: "ì»µ"}, {k: "ã‚¹ãƒ—ãƒ¼ãƒ³", m: "ìŠ¤í‘¼"}, {k: "ãƒ•ã‚©ãƒ¼ã‚¯", m: "í¬í¬"}, {k: "ãƒŠã‚¤ãƒ•", m: "ë‚˜ì´í”„"},
        {k: "ã‚·ãƒ£ãƒ„", m: "ì…”ì¸ "}, {k: "ãƒ‘ãƒ³ãƒ„", m: "íŒ¬ì¸ "}, {k: "ã‚¹ã‚«ãƒ¼ãƒˆ", m: "ìŠ¤ì»¤íŠ¸"}, {k: "ãƒã‚¯ã‚¿ã‚¤", m: "ë„¥íƒ€ì´"},
        {k: "ãƒãƒƒã‚°", m: "ë°±"}, {k: "ãƒ¡ã‚¬ãƒ", m: "ì•ˆê²½"}, {k: "ãƒãƒƒã‚¯ãƒ¬ã‚¹", m: "ëª©ê±¸ì´"}, {k: "ã‚·ãƒ£ãƒ³ãƒ—ãƒ¼", m: "ìƒ´í‘¸"},
        {k: "ã‚¿ã‚ªãƒ«", m: "íƒ€ì›”"}, {k: "ãƒ–ãƒ©ã‚·", m: "ë¸ŒëŸ¬ì‹œ"}, {k: "ãƒãƒƒã‚µãƒ¼ã‚¸", m: "ë§ˆì‚¬ì§€"}, {k: "ã‚¹ãƒãƒ¼ãƒ„", m: "ìŠ¤í¬ì¸ "},
        {k: "ã‚­ãƒ£ãƒ³ãƒ—", m: "ìº í”„"}, {k: "ãƒ‰ãƒ©ã‚¤ãƒ–", m: "ë“œë¼ì´ë¸Œ"}, {k: "ã‚¤ãƒ™ãƒ³ãƒˆ", m: "ì´ë²¤íŠ¸"}, {k: "ãƒãƒ£ãƒ³ã‚¹", m: "ì°¬ìŠ¤"},
        {k: "ã‚¢ãƒ‰ãƒã‚¤ã‚¹", m: "ì–´ë“œë°”ì´ìŠ¤"}, {k: "ãƒˆãƒ©ãƒ–ãƒ«", m: "íŠ¸ëŸ¬ë¸”"}, {k: "ã‚¹ã‚¿ã‚¤ãƒ«", m: "ìŠ¤íƒ€ì¼"}, {k: "ãƒ‡ã‚¶ã‚¤ãƒ³", m: "ë””ìì¸"},
        {k: "ã‚¤ãƒ¡ãƒ¼ã‚¸", m: "ì´ë¯¸ì§€"}, {k: "ãƒ¢ãƒ‡ãƒ«", m: "ëª¨ë¸"}, {k: "ã‚¢ã‚¤ãƒ‰ãƒ«", m: "ì•„ì´ëŒ"}, {k: "ã‚¹ã‚¿ãƒ¼", m: "ìŠ¤íƒ€"},
        {k: "ã‚¸ãƒ£ã‚º", m: "ì¬ì¦ˆ"}, {k: "ãƒ­ãƒƒã‚¯", m: "ë¡"}, {k: "ãƒãƒƒãƒ—ã‚¹", m: "íŒ"}, {k: "ã‚¯ãƒ©ã‚·ãƒƒã‚¯", m: "í´ë˜ì‹"},
        {k: "ãƒ¯ãƒ¼ãƒ«ãƒ‰", m: "ì›”ë“œ"}, {k: "ã‚µãƒ¼ãƒ“ã‚¹", m: "ì„œë¹„ìŠ¤"}, {k: "ã‚·ã‚¹ãƒ†ãƒ ", m: "ì‹œìŠ¤í…œ"}, {k: "ãƒ‡ãƒ¼ã‚¿", m: "ë°ì´í„°"},
        {k: "ãƒ‡ã‚¸ã‚¿ãƒ«", m: "ë””ì§€í„¸"}, {k: "ãƒãƒƒãƒˆ", m: "ë„·"}, {k: "ãƒ—ãƒ­", m: "í”„ë¡œ"}, {k: "ãƒãƒ¼ãƒ ", m: "íŒ€"},
        {k: "ãƒ«ãƒ¼ãƒ«", m: "ë£°"}, {k: "ã‚³ãƒ¼ã‚¹", m: "ì½”ìŠ¤"}, {k: "ã‚¨ãƒªã‚¢", m: "ì—ë¦¬ì–´"}, {k: "ã‚·ãƒ§ãƒƒãƒ—", m: "ìˆ"},
        {k: "ãƒ‡ãƒ‘ãƒ¼ãƒˆ", m: "ë°íŒŒíŠ¸"}, {k: "ã‚¹ãƒ¼ãƒ‘ãƒ¼", m: "ìŠˆí¼"}, {k: "ãƒ“ãƒ«", m: "ë¹Œë”©"}, {k: "ã‚¨ãƒ³ã‚¸ãƒ³", m: "ì—”ì§„"}
    ];

    let currentQuizSet = [], currentIdx = 0, correctCount = 0, failedQuestions = [], isReviewMode = false;

    // [ê°•ë ¥ í•„í„°] ì¼ë³¸ì–´(ê°€ë‚˜/í•œì)ë§Œ í¬í•¨ëœ ë¬¸ìì¸ì§€ í™•ì¸í•˜ëŠ” í•¨ìˆ˜
    function isOnlyJapanese(str) {
        return /^[ã-ã‚“ã‚¡-ãƒ¶ãƒ¼ä¸€-é¾¯]+$/.test(str);
    }

    function playSound(isCorrect) {
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        const masterGain = audioCtx.createGain();
        masterGain.connect(audioCtx.destination);
        masterGain.gain.setValueAtTime(0.05, audioCtx.currentTime); 

        if (isCorrect) {
            const notes = [523.25, 659.25, 783.99, 1046.50]; 
            notes.forEach((freq, i) => {
                const osc = audioCtx.createOscillator();
                const g = audioCtx.createGain();
                osc.type = 'sine';
                osc.frequency.setValueAtTime(freq, audioCtx.currentTime + i * 0.1);
                g.gain.setValueAtTime(0, audioCtx.currentTime + i * 0.1);
                g.gain.linearRampToValueAtTime(0.2, audioCtx.currentTime + i * 0.1 + 0.05);
                g.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + i * 0.1 + 0.5);
                osc.connect(g);
                g.connect(masterGain);
                osc.start(audioCtx.currentTime + i * 0.1);
                osc.stop(audioCtx.currentTime + i * 0.1 + 0.6);
            });
        }
    }

    function speak(text) {
        window.speechSynthesis.cancel();
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = 'ja-JP';
        window.speechSynthesis.speak(utterance);
    }

    function startGame() {
        isReviewMode = false; failedQuestions = [];
        // ì‹œì‘í•  ë•Œ í•œê¸€ì´ ì„ì¸ ì˜ëª»ëœ ë°ì´í„°ëŠ” ì‚¬ì „ì— í•„í„°ë§
        const safeData = originalData.filter(item => isOnlyJapanese(item.k));
        currentQuizSet = [...safeData].sort(() => Math.random() - 0.5).slice(0, 10);
        resetState();
    }

    function startRetryMode() {
        isReviewMode = true;
        currentQuizSet = [...failedQuestions].sort(() => Math.random() - 0.5);
        failedQuestions = []; 
        resetState();
    }

    function resetState() {
        currentIdx = 0; correctCount = 0;
        document.getElementById('mode-indicator').innerText = isReviewMode ? "ë³µìŠµ ëª¨ë“œ ğŸ”" : "í•™ìŠµ ëª¨ë“œ âœ¨";
        document.getElementById('quiz-screen').style.display = 'flex';
        document.getElementById('result-screen').style.display = 'none';
        hideFeedback();
        renderQuestion();
    }

    function hideFeedback() {
        document.getElementById('feedback').innerText = "";
        document.getElementById('next-btn').style.visibility = 'hidden';
    }

    function renderQuestion() {
        if (currentIdx >= currentQuizSet.length) { showResult(); return; }
        const q = currentQuizSet[currentIdx];
        const numOptions = parseInt(document.getElementById('option-count').value);
        
        document.getElementById('word-display').innerText = q.m;
        document.getElementById('current-q-num').innerText = currentIdx + 1;
        document.getElementById('correct-q-num').innerText = correctCount;

        let options = [q.k];
        // ë³´ê¸° í›„ë³´ë¥¼ ê³ ë¥¼ ë•Œë„ í•œê¸€ì´ í¬í•¨ëœ ë‹¨ì–´ëŠ” ì² ì €íˆ ë°°ì œ
        let others = originalData.filter(item => item.k !== q.k && isOnlyJapanese(item.k)).sort(() => Math.random() - 0.5);
        for(let i=0; i < numOptions - 1; i++) { if(others[i]) options.push(others[i].k); }
        options.sort(() => Math.random() - 0.5);

        const optionsDiv = document.getElementById('options');
        optionsDiv.innerHTML = "";
        options.forEach(opt => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.innerText = opt;
            btn.onclick = () => checkAnswer(opt, q);
            optionsDiv.appendChild(btn);
        });
    }

    function checkAnswer(selected, qObj) {
        const allBtns = document.querySelectorAll('#options button');
        allBtns.forEach(b => b.disabled = true);

        const feedback = document.getElementById('feedback');
        if (selected === qObj.k) {
            playSound(true);
            feedback.innerHTML = `<span class="correct">ğŸˆ ì •ë‹µì…ë‹ˆë‹¤!</span>`;
            correctCount++;
        } else {
            feedback.innerHTML = `<span class="incorrect">ğŸ˜¢ ì •ë‹µì€ <strong>'${qObj.k}'</strong>ì…ë‹ˆë‹¤.</span>`;
            if (!failedQuestions.some(item => item.k === qObj.k)) failedQuestions.push(qObj);
        }
        
        setTimeout(() => speak(qObj.k), 300);
        document.getElementById('next-btn').style.visibility = 'visible';
    }

    function goToNextQuestion() {
        currentIdx++;
        hideFeedback();
        renderQuestion();
    }

    function showResult() {
        document.getElementById('quiz-screen').style.display = 'none';
        document.getElementById('result-screen').style.display = 'flex';
        document.getElementById('result-stats').innerText = `${currentQuizSet.length}ë¬¸ì œ ì¤‘ ${correctCount}ê°œ ì„±ê³µ!`;
        document.getElementById('retry-failed-btn').style.display = failedQuestions.length > 0 ? 'block' : 'none';
    }

    window.onload = startGame;
</script>
</body>
</html>
