<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>í•œì HARD ë§ˆìŠ¤í„° ğŸ”¥</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ”¥</text></svg>">
    <link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic:wght@400;700&family=Nanum+Pen+Script&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-gradient: linear-gradient(135deg, #fff5f5 0%, #f0f4ff 100%);
            --card-bg: rgba(255, 255, 255, 0.95);
            --primary: #ffb7b2;
            --accent: #ffdac1;
            --text-color: #5d5d5d;
            --btn-bg: #ffffff;
            --btn-shadow: #e0e0e0;
        }

        body { 
            font-family: 'Nanum Gothic', sans-serif; 
            background: var(--bg-gradient); 
            color: var(--text-color);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            margin: 0; padding: 0; 
            height: 100vh; /* 2) ì„¸ë¡œ ìŠ¤í¬ë¡¤ ë°©ì§€ */
            overflow: hidden;
            touch-action: manipulation;
        }

        /* 1) ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ëŠ” í™ˆ ë²„íŠ¼ */
        .home-btn {
            position: absolute; top: 15px; right: 15px;
            text-decoration: none; font-size: 24px;
            background: #fff; width: 45px; height: 45px;
            display: flex; align-items: center; justify-content: center;
            border-radius: 50%; box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            z-index: 100;
        }

        #game-container { 
            background: var(--card-bg); 
            padding: 20px; border-radius: 35px; 
            box-shadow: 0 15px 35px rgba(255, 183, 178, 0.2); 
            width: 90%; max-width: 420px; 
            height: 85vh;
            display: flex; flex-direction: column; justify-content: space-between;
            border: 6px solid #fff; box-sizing: border-box;
            position: relative; text-align: center;
        }

        .header { flex-shrink: 0; }
        .mode-badge {
            display: inline-block; padding: 5px 16px; border-radius: 50px;
            font-size: 13px; font-weight: bold; margin-bottom: 8px;
            color: white; background: var(--primary);
        }

        #word-display { 
            font-family: 'serif'; 
            font-size: 14vh;
            font-weight: bold;
            color: #444; 
            flex-grow: 1;
            display: flex; align-items: center; justify-content: center;
        }

        .options-grid { 
            display: grid; gap: 10px; 
            margin-bottom: 5px;
            flex-shrink: 0;
        }
        
        button { 
            font-family: 'Nanum Gothic', sans-serif;
            padding: 14px; font-size: 22px; cursor: pointer; 
            border: none; border-radius: 20px; 
            background: var(--btn-bg); color: var(--text-color);
            box-shadow: 0 5px 0px var(--btn-shadow);
            transition: all 0.1s;
        }
        button:active:not(:disabled) { transform: translateY(3px); box-shadow: none; }
        button:disabled { opacity: 0.6; }

        #feedback-area {
            height: 100px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin-bottom: 10px;
        }
        #feedback { 
            font-family: 'Nanum Pen Script', cursive;
            font-size: 26px;
            text-align: center;
            word-break: keep-all;
            margin-bottom: 8px;
        }
        .correct { color: #64b5f6; }
        .incorrect { color: #ff8a80; }

        #next-btn {
            background: #ffdac1;
            font-size: 16px;
            padding: 8px 20px;
            border-radius: 50px;
            box-shadow: 0 4px 0px #e5c2ac;
            color: #8a6d5a;
            font-weight: bold;
            border: none; cursor: pointer;
            display: none;
        }

        #score-display { 
            font-size: 13px; color: #aaa;
            background: #fff; padding: 12px; border-radius: 20px;
            display: flex; justify-content: space-around;
            border: 1px solid #f0f0f0;
        }

        .result-screen { display: none; height: 100%; flex-direction: column; justify-content: center; align-items: center; }
        .btn-action { color: white; font-weight: bold; margin-top: 12px; width: 100%; padding: 18px; border-radius: 22px; border: none; cursor: pointer; font-size: 18px; }
        .btn-red { background: var(--primary); box-shadow: 0 5px 0px #e5a19d; }
        .btn-blue { background: #b2e2f2; box-shadow: 0 5px 0px #9bc5d3; }
    </style>
</head>
<body>

    <a href="index.html" class="home-btn">ğŸ </a>

    <div id="game-container">
        <div id="quiz-screen" style="height: 100%; display: flex; flex-direction: column;">
            <div class="header">
                <div id="mode-indicator" class="mode-badge">í•œì HARD ëª¨ë“œ ğŸ”¥</div>
            </div>

            <div id="word-display">...</div>

            <div id="feedback-area">
                <div id="feedback"></div>
                <button id="next-btn" onclick="goToNextQuestion()">ë‹¤ìŒ ë¬¸ì œ â¯</button>
            </div>

            <div id="options" class="options-grid"></div>
            
            <div id="score-display">
                <span>ğŸ“ <span id="current-q-num">1</span>/10</span>
                <span>â­ <span id="correct-q-num">0</span></span>
            </div>
        </div>

        <div id="result-screen" class="result-screen">
            <span style="font-size: 60px;">ğŸŒ¸</span>
            <h2 id="result-title" style="margin: 15px 0; color: #444;">í•˜ë“œ ëª¨ë“œ ì •ë³µ!</h2>
            <p id="result-stats" style="font-size: 22px; color: #888; margin: 5px 0;"></p>
            <p id="result-msg" style="font-size: 16px; color: #aaa; margin-bottom: 25px; text-align: center;"></p>
            <button onclick="startGame()" class="btn-action btn-red">âœ¨ ìƒˆ ê²Œì„ ì‹œì‘</button>
            <button id="retry-failed-btn" onclick="startRetryMode()" class="btn-action btn-blue">ğŸ” ì˜¤ë‹µ ë³µìŠµí•˜ê¸°</button>
        </div>
    </div>

<script>
    // [4) ë°ì´í„° ì •ì œ ì™„ë£Œ] h í•„ë“œì˜ ëª¨ë“  í•œê¸€ ë°œìŒ(ë‚˜ì¯”, ì¡°ìš° ë“±)ì„ íˆë¼ê°€ë‚˜ë¡œ ì •ì •í–ˆìŠµë‹ˆë‹¤.
    const kanjiData = [
        {k: "æ°´", h: "ã¿ãš", p: "ë¯¸ì¦ˆ", m: "ë¬¼"}, {k: "äºº", h: "ã²ã¨", p: "íˆí† ", m: "ì‚¬ëŒ"}, {k: "å±±", h: "ã‚„ã¾", p: "ì•¼ë§ˆ", m: "ì‚°"},
        {k: "æ—¥", h: "ã²", p: "íˆ", m: "í•´/ë‚ "}, {k: "å£", h: "ãã¡", p: "ì¿ ì¹˜", m: "ì…"}, {k: "æœ¨", h: "ã", p: "í‚¤", m: "ë‚˜ë¬´"},
        {k: "è»Š", h: "ãã‚‹ã¾", p: "ì¿ ë£¨ë§ˆ", m: "ìë™ì°¨"}, {k: "ç©º", h: "ãã‚‰", p: "ì†Œë¼", m: "í•˜ëŠ˜"}, {k: "æ‰‹", h: "ã¦", p: "í…Œ", m: "ì†"},
        {k: "å­", h: "ã“", p: "ì½”", m: "ì•„ì´"}, {k: "æœˆ", h: "ã¤ã", p: "ì¸ í‚¤", m: "ë‹¬"}, {k: "ç«", h: "ã²", p: "íˆ", m: "ë¶ˆ"},
        {k: "åœŸ", h: "ã¤ã¡", p: "ì¸ ì¹˜", m: "í™"}, {k: "é‡‘", h: "ã‹ã­", p: "ì¹´ë„¤", m: "ëˆ/ê¸ˆ"}, {k: "å¥³", h: "ãŠã‚“ãª", p: "ì˜¨ë‚˜", m: "ì—¬ì"},
        {k: "ç”·", h: "ãŠã¨ã“", p: "ì˜¤í† ì½”", m: "ë‚¨ì"}, {k: "ç›®", h: "ã‚", p: "ë©”", m: "ëˆˆ"}, {k: "è€³", h: "ã¿ã¿", p: "ë¯¸ë¯¸", m: "ê·€"},
        {k: "è¶³", h: "ã‚ã—", p: "ì•„ì‹œ", m: "ë°œ"}, {k: "èŠ±", h: "ã¯ãª", p: "í•˜ë‚˜", m: "ê½ƒ"}, {k: "å·", h: "ã‹ã‚", p: "ì¹´ì™€", m: "ê°•"},
        {k: "çŸ³", h: "ã„ã—", p: "ì´ì‹œ", m: "ëŒ"}, {k: "å¤©", h: "ã¦ã‚“", p: "í…", m: "í•˜ëŠ˜"}, {k: "æ°—", h: "ã", p: "í‚¤", m: "ê¸°ìš´"},
        {k: "é›¨", h: "ã‚ã‚", p: "ì•„ë©”", m: "ë¹„"}, {k: "ä¸‹", h: "ã—ãŸ", p: "ì‹œíƒ€", m: "ì•„ë˜"}, {k: "ä¸Š", h: "ã†ãˆ", p: "ìš°ì—", m: "ìœ„"},
        {k: "å³", h: "ã¿ã", p: "ë¯¸ê¸°", m: "ì˜¤ë¥¸ìª½"}, {k: "å·¦", h: "ã²ã ã‚Š", p: "íˆë‹¤ë¦¬", m: "ì™¼ìª½"}, {k: "å", h: "ë‚˜", p: "ë‚˜", m: "ì´ë¦„"},
        {k: "é¢¨", h: "ã‹ãœ", p: "ì¹´ì œ", m: "ë°”ëŒ"}, {k: "æµ·", h: "ã†ã¿", p: "ìš°ë¯¸", m: "ë°”ë‹¤"}, {k: "é“", h: "ã¿ã¡", p: "ë¯¸ì¹˜", m: "ê¸¸"},
        {k: "æ£®", h: "ã‚‚ã‚Š", p: "ëª¨ë¦¬", m: "ìˆ²"}, {k: "æ—", h: "ã¯ã‚„ã—", p: "í•˜ì•¼ì‹œ", m: "ìˆ˜í’€"}, {k: "éŸ³", h: "ãŠã¨", p: "ì˜¤í† ", m: "ì†Œë¦¬"},
        {k: "è‰", h: "ãã•", p: "ì¿ ì‚¬", m: "í’€"}, {k: "è™«", h: "ã‚€ã—", p: "ë¬´ì‹œ", m: "ë²Œë ˆ"}, {k: "è²", h: "ã‹ã„", p: "ì¹´ì´", m: "ì¡°ê°œ"},
        {k: "é›ª", h: "ã‚†ã", p: "ìœ í‚¤", m: "ëˆˆ(ë‚ ì”¨)"}, {k: "ç«¹", h: "ãŸã‘", p: "íƒ€ì¼€", m: "ëŒ€ë‚˜ë¬´"}, {k: "ç±³", h: "ã“ã‚", p: "ì½”ë©”", m: "ìŒ€"},
        {k: "ç•‘", h: "ã¯ãŸã‘", p: "í•˜íƒ€ì¼€", m: "ë°­"}, {k: "å²©", h: "ã„ã‚", p: "ì´ì™€", m: "ë°”ìœ„"}, {k: "å…‰", h: "ã²ã‹ã‚Š", p: "íˆì¹´ë¦¬", m: "ë¹›"},
        {k: "æ˜Ÿ", h: "ã»ã—", p: "í˜¸ì‹œ", m: "ë³„"}, {k: "é›²", h: "ãã‚‚", p: "ì¿ ëª¨", m: "êµ¬ë¦„"}, {k: "æ± ", h: "ã„ã‘", p: "ì´ì¼€", m: "ì—°ëª»"},
        {k: "é¡”", h: "ã‹ãŠ", p: "ì¹´ì˜¤", m: "ì–¼êµ´"}, {k: "é ­", h: "ã‚ãŸã¾", p: "ì•„íƒ€ë§ˆ", m: "ë¨¸ë¦¬"}, {k: "é¦–", h: "ãã³", p: "ì¿ ë¹„", m: "ëª©"},
        {k: "æŒ‡", h: "ã‚†ã³", p: "ìœ ë¹„", m: "ì†ê°€ë½"}, {k: "çˆ¶", h: "ã¡ã¡", p: "ì¹˜ì¹˜", m: "ì•„ë²„ì§€"}, {k: "æ¯", h: "ã¯ã¯", p: "í•˜í•˜", m: "ì–´ë¨¸ë‹ˆ"},
        {k: "å…„", h: "ã‚ã«", p: "ì•„ë‹ˆ", m: "í˜•/ì˜¤ë¹ "}, {k: "å§‰", h: "ã‚ã­", p: "ì•„ë„¤", m: "ëˆ„ë‚˜/ì–¸ë‹ˆ"}, {k: "å¼Ÿ", h: "ãŠã¨ã†ã¨", p: "ì˜¤í† ìš°í† ", m: "ë‚¨ë™ìƒ"},
        {k: "å¦¹", h: "ã„ã‚‚ã†ã¨", p: "ì´ëª¨ìš°í† ", m: "ì—¬ë™ìƒ"}, {k: "å‹", h: "ã¨ã‚‚", p: "í† ëª¨", m: "ì¹œêµ¬"}, {k: "æœ", h: "ã‚ã•", p: "ì•„ì‚¬", m: "ì•„ì¹¨"},
        {k: "æ˜¼", h: "ã²ã‚‹", p: "íˆë£¨", m: "ë‚®"}, {k: "æ™©", h: "ã°ã‚“", p: "ë°˜", m: "ì €ë…"}, {k: "å¤œ", h: "ã‚ˆã‚‹", p: "ìš”ë£¨", m: "ë°¤"},
        {k: "æ˜¥", h: "ã¯ã‚‹", p: "í•˜ë£¨", m: "ë´„"}, {k: "å¤", h: "ãªã¤", p: "ë‚˜ì¸ ", m: "ì—¬ë¦„"}, {k: "ç§‹", h: "ã‚ã", p: "ì•„í‚¤", m: "ê°€ì„"},
        {k: "å†¬", h: "ãµã‚†", p: "í›„ìœ ", m: "ê²¨ìš¸"}, {k: "ä»Š", h: "ã„ã¾", p: "ì´ë§ˆ", m: "ì§€ê¸ˆ"}, {k: "æ™‚", h: "ã¨ã", p: "í† í‚¤", m: "ë•Œ/ì‹œê°„"},
        {k: "é€±", h: "ã—ã‚…ã†", p: "ìŠˆìš°", m: "ì£¼ì¼"}, {k: "å¹´", h: "ã¨ã—", p: "í† ì‹œ", m: "í•´(year)"}, {k: "é–“", h: "ã‚ã„ã ", p: "ì•„ì´ë‹¤", m: "ì‚¬ì´"},
        {k: "æœ¬", h: "ã»ã‚“", p: "í˜¼", m: "ì±…"}, {k: "åº—", h: "ã¿ã›", p: "ë¯¸ì„¸", m: "ê°€ê²Œ"}, {k: "å®¶", h: "ã„ãˆ", p: "ì´ì—", m: "ì§‘"},
        {k: "é§…", h: "ãˆã", p: "ì—í‚¤", m: "ì—­"}, {k: "è¡—", h: "ã¾ã¡", p: "ë§ˆì¹˜", m: "ê±°ë¦¬"}, {k: "å¯º", h: "ã¦ë¼", p: "í…Œë¼", m: "ì ˆ"},
        {k: "é–€", h: "ã‚‚ã‚“", p: "ëª¬", m: "ë¬¸"}, {k: "çª“", h: "ã¾ã©", p: "ë§ˆë„", m: "ì°½ë¬¸"}, {k: "ç´™", h: "ã‹ã¿", p: "ì¹´ë¯¸", m: "ì¢…ì´"},
        {k: "ç­†", h: "í›„ë°", p: "í›„ë°", m: "ë¶“"}, {k: "ç®±", h: "ã¯ã“", p: "í•˜ì½”", m: "ìƒì"}, {k: "å‚˜", h: "ã‹ã•", p: "ì¹´ì‚¬", m: "ìš°ì‚°"},
        {k: "æœ", h: "ãµã", p: "í›„ì¿ ", m: "ì˜·"}, {k: "é´", h: "ãã¤", p: "ì¿ ì¸ ", m: "ì‹ ë°œ"}, {k: "é„", h: "ã‹ã°ã‚“", p: "ì¹´ë°˜", m: "ê°€ë°©"},
        {k: "é³¥", h: "ã¨ã‚Š", p: "í† ë¦¬", m: "ìƒˆ"}, {k: "é¦¬", h: "ã†ã¾", p: "ìš°ë§ˆ", m: "ë§"}, {k: "ç‰›", h: "ã†ã—", p: "ìš°ì‹œ", m: "ì†Œ"},
        {k: "é­š", h: "ã•ã‹ãª", p: "ì‚¬ì¹´ë‚˜", m: "ë¬¼ê³ ê¸°"}, {k: "è‚‰", h: "ã«ã", p: "ë‹ˆì¿ ", m: "ê³ ê¸°"}, {k: "åµ", h: "ãŸã¾ã”", p: "íƒ€ë§ˆê³ ", m: "ê³„ë€"},
        {k: "èŒ¶", h: "ã¡ã‚ƒ", p: "ì± ", m: "ì°¨(tea)"}, {k: "é…’", h: "ã•ã‘", p: "ì‚¬ì¼€", m: "ìˆ "}, {k: "å¡©", h: "ã—ãŠ", p: "ì‹œì˜¤", m: "ì†Œê¸ˆ"},
        {k: "ç ‚ç³–", h: "ã•ã¨ã†", p: "ì‚¬í† ìš°", m: "ì„¤íƒ•"}, {k: "æ²¹", h: "ã‚ã¶ã‚‰", p: "ì•„ë¶€ë¼", m: "ê¸°ë¦„"}, {k: "å‘³", h: "ã‚ã˜", p: "ì•„ì§€", m: "ë§›"},
        {k: "è‰²", h: "ã„ã‚", p: "ì´ë¡œ", m: "ìƒ‰ê¹”"}, {k: "èµ¤", h: "ã‚ã‹", p: "ì•„ì¹´", m: "ë¹¨ê°•"}, {k: "é’", h: "ã‚ãŠ", p: "ì•„ì˜¤", m: "íŒŒë‘"},
        {k: "ç™½", h: "ã—ã‚", p: "ì‹œë¡œ", m: "í•˜ì–‘"}, {k: "é»’", h: "ãã‚", p: "ì¿ ë¡œ", m: "ê²€ì •"}, {k: "æ­Œ", h: "ã†ãŸ", p: "ìš°íƒ€", m: "ë…¸ë˜"},
        {k: "çµµ", h: "ãˆ", p: "ì—", m: "ê·¸ë¦¼"}, {k: "å­—", h: "ã˜", p: "ì§€", m: "ê¸€ì"}, {k: "è©±", h: "ã¯ãªã—", p: "í•˜ë‚˜ì‹œ", m: "ì´ì•¼ê¸°"},
        {k: "å¤¢", h: "ã‚†ã‚", p: "ìœ ë©”", m: "ê¿ˆ"}, {k: "å¿ƒ", h: "ã“ã“ã‚", p: "ì½”ì½”ë¡œ", m: "ë§ˆìŒ"}, {k: "ä½“", h: "ã‹ã‚‰ã ", p: "ì¹´ë¼ë‹¤", m: "ëª¸"},
        {k: "å£°", h: "ã“ãˆ", p: "ì½”ì—", m: "ëª©ì†Œë¦¬"}, {k: "åŠ›", h: "ã¡ã‹ã‚‰", p: "ì¹˜ì¹´ë¼", m: "í˜"}, {k: "å‘½", h: "ã„ã®ã¡", p: "ì´ë…¸ì¹˜", m: "ìƒëª…"},
        {k: "ç¥", h: "ã‹ã¿", p: "ì¹´ë¯¸", m: "ì‹ "}, {k: "ç¥­", h: "ã¾ã¤ã‚Š", p: "ë§ˆì¸ ë¦¬", m: "ì¶•ì œ"}, {k: "æ©‹", h: "ã¯ã—", p: "í•˜ì‹œ", m: "ë‹¤ë¦¬"},
        {k: "èˆ¹", h: "ãµã­", p: "í›„ë„¤", m: "ë°°(ship)"}, {k: "çŸ¢", h: "ã‚„", p: "ì•¼", m: "í™”ì‚´"}, {k: "åˆ€", h: "ã‹ãŸãª", p: "ì¹´íƒ€ë‚˜", m: "ì¹¼"},
        {k: "æ—…", h: "ãŸã³", p: "íƒ€ë¹„", m: "ì—¬í–‰"}, {k: "æ˜”", h: "ã‚€ã‹ã—", p: "ë¬´ì¹´ì‹œ", m: "ì˜›ë‚ "}, {k: "é¡", h: "ã‹ãŒã¿", p: "ì¹´ê°€ë¯¸", m: "ê±°ìš¸"},
        {k: "è–¬", h: "ãã™ã‚Š", p: "ì¿ ìŠ¤ë¦¬", m: "ì•½"}, {k: "æ¯’", h: "ã©ã", p: "ë„ì¿ ", m: "ë…"}, {k: "éµ", h: "ã‹ã", p: "ì¹´ê¸°", m: "ì—´ì‡ "},
        {k: "å£", h: "ã‹ã¹", p: "ì¹´ë² ", m: "ë²½"}, {k: "æŸ±", h: "ã¯ã—ã‚‰", p: "í•˜ì‹œë¼", m: "ê¸°ë‘¥"}, {k: "è§’", h: "ã‹ã©", p: "ì¹´ë„", m: "ëª¨í‰ì´"},
        {k: "æ‰€", h: "ã¨ã“ã‚", p: "í† ì½”ë¡œ", m: "ì¥ì†Œ"}, {k: "å¥¥", h: "ãŠã", p: "ì˜¤ì¿ ", m: "ì•ˆìª½"}, {k: "ç«¯", h: "ã¯ã—", p: "í•˜ì‹œ", m: "ë"},
        {k: "è¡¨", h: "ãŠã‚‚ã¦", p: "ì˜¤ëª¨í…Œ", m: "ê²‰"}, {k: "è£", h: "ã†ã‚‰", p: "ìš°ë¼", m: "ì†/ë’¤"}, {k: "å½±", h: "ã‹ã’", p: "ì¹´ê²Œ", m: "ê·¸ë¦¼ì"},
        {k: "æ³¢", h: "ãªã¿", p: "ë‚˜ë¯¸", m: "ë¬¼ê²°"}, {k: "æ°·", h: "ã“ãŠã‚Š", p: "ì½”ì˜¤ë¦¬", m: "ì–¼ìŒ"},
        {k: "æ¹¯", h: "ã‚†", p: "ìœ ", m: "ì˜¨ìˆ˜"}, {k: "æ¸¯", h: "ã¿ãªã¨", p: "ë¯¸ë‚˜í† ", m: "í•­êµ¬"}, {k: "åº­", h: "ã«ã‚", p: "ë‹ˆì™€", m: "ë§ˆë‹¹"},
        {k: "åŸ", h: "ã¯ã‚‰", p: "í•˜ë¼", m: "ë“¤íŒ"}, {k: "è°·", h: "ãŸã«", p: "íƒ€ë‹ˆ", m: "ê³¨ì§œê¸°"},
        {k: "å´–", h: "ê°€ì¼€", p: "ê°€ì¼€", m: "ì ˆë²½"}, {k: "ç©´", h: "ã‚ãª", p: "ì•„ë‚˜", m: "êµ¬ë©"}, {k: "ç½ ", h: "ã‚ãª", p: "ì™€ë‚˜", m: "í•¨ì •"},
        {k: "çŠ¬", h: "ì´ëˆ„", p: "ì´ëˆ„", m: "ê°œ"}, {k: "çŒ«", h: "ã­ã“", p: "ë„¤ì½”", m: "ê³ ì–‘ì´"}, {k: "çŒ¿", h: "ã•ã‚‹", p: "ì‚¬ë£¨", m: "ì›ìˆ­ì´"},
        {k: "ç†Š", h: "ãã¾", p: "ì¿ ë§ˆ", m: "ê³°"}, {k: "è™", h: "ã¨ã‚‰", p: "í† ë¼", m: "í˜¸ë‘ì´"}, {k: "é¾", h: "ã‚Šã‚…ã†", p: "ë¥˜ìš°", m: "ìš©"},
        {k: "é¹¿", h: "ã—ã‹", p: "ì‹œì¹´", m: "ì‚¬ìŠ´"}, {k: "çŒª", h: "ã„ã®ã—ã—", p: "ì´ë…¸ì‹œì‹œ", m: "ë©§ë¼ì§€"}, {k: "è±¡", h: "ãã†", p: "ì¡°ìš°", m: "ì½”ë¼ë¦¬"},
        {k: "è›‡", h: "ã¸ã³", p: "í—¤ë¹„", m: "ë±€"}, {k: "äº€", h: "ã‹ã‚", p: "ì¹´ë©”", m: "ê±°ë¶ì´"}, {k: "è›™", h: "ã‹ãˆã‚‹", p: "ì¹´ì—ë£¨", m: "ê°œêµ¬ë¦¬"},
        {k: "é¶´", h: "ã¤ã‚‹", p: "ì¸ ë£¨", m: "í•™"}, {k: "é›€", h: "ã™ãšã‚", p: "ìŠ¤ì¦ˆë©”", m: "ì°¸ìƒˆ"}, {k: "é³©", h: "ã¯ã¨", p: "í•˜í† ", m: "ë¹„ë‘˜ê¸°"},
        {k: "èŸ»", h: "ã‚ã‚Š", p: "ì•„ë¦¬", m: "ê°œë¯¸"}, {k: "èœ‚", h: "ã¯ã¡", p: "í•˜ì¹˜", m: "ë²Œ"}, {k: "è¶", h: "ã¡ã‚‡ã†", p: "ìµ¸ìš°", m: "ë‚˜ë¹„"},
        {k: "æ ¹", h: "ã­", p: "ë„¤", m: "ë¿Œë¦¬"}, {k: "è‘‰", h: "ã¯", p: "í•˜", m: "ì"},
        {k: "æ", h: "ãˆã ", p: "ì—ë‹¤", m: "ê°€ì§€"}, {k: "å®Ÿ", h: "ã¿", p: "ë¯¸", m: "ì—´ë§¤"}, {k: "ç¨®", h: "ãŸã­", p: "íƒ€ë„¤", m: "ì”¨ì•—"},
        {k: "éº¦", h: "ã‚€ã", p: "ë¬´ê¸°", m: "ë³´ë¦¬"}, {k: "ç¨²", h: "ã„ã­", p: "ì´ë„¤", m: "ë²¼"}, {k: "è±†", h: "ã¾ã‚", p: "ë§ˆë©”", m: "ì½©"},
        {k: "èŠ‹", h: "ã„ã‚‚", p: "ì´ëª¨", m: "ê°ì/ê³ êµ¬ë§ˆ"}, {k: "æ —", h: "ãã‚Š", p: "ì¿ ë¦¬", m: "ë°¤(ì—´ë§¤)"}, {k: "æŸ¿", h: "ã‹ã", p: "ì¹´í‚¤", m: "ê°"},
        {k: "æ¡ƒ", h: "ã‚‚ã‚‚", p: "ëª¨ëª¨", m: "ë³µìˆ­ì•„"}, {k: "æ¢¨", h: "ãªã—", p: "ë‚˜ì‹œ", m: "ë°°(fruit)"}, {k: "æ¢…", h: "ã†ã‚", p: "ìš°ë©”", m: "ë§¤í™”"},
        {k: "æ¾", h: "ã¾ã¤", p: "ë§ˆì¸ ", m: "ì†Œë‚˜ë¬´"}, {k: "æ‰", h: "ã™ã", p: "ìŠ¤ê¸°", m: "ì‚¼ë‚˜ë¬´"}, {k: "æ¡œ", h: "ã•ãã‚‰", p: "ì‚¬ì¿ ë¼", m: "ë²šê½ƒ"},
        {k: "æŸ³", h: "ã‚„ãªã", p: "ì•¼ë‚˜ê¸°", m: "ë²„ë“œë‚˜ë¬´"}, {k: "éŠ€", h: "ãã‚“", p: "ê¸´", m: "ì€"}, {k: "é‰„", h: "ã¦ã¤", p: "í…Œì¸ ", m: "ì² "},
        {k: "éŠ…", h: "ã©ã†", p: "ë„ìš°", m: "êµ¬ë¦¬"}, {k: "æ³¥", h: "ã©ã‚", p: "ë„ë¡œ", m: "ì§„í™"}, {k: "ç‚­", h: "ã™ã¿", p: "ìŠ¤ë¯¸", m: "ìˆ¯"},
        {k: "ç¶¿", h: "ã‚ãŸ", p: "ì™€íƒ€", m: "ì†œ/ë©´"}, {k: "çµ¹", h: "ãã¬", p: "í‚¤ëˆ„", m: "ë¹„ë‹¨"}, {k: "å¸ƒ", h: "ã¬ã®", p: "ëˆ„ë…¸", m: "ì²œ"},
        {k: "ç³¸", h: "ã„ã¨", p: "ì´í† ", m: "ì‹¤"}, {k: "é‡", h: "ã¯ã‚Š", p: "í•˜ë¦¬", m: "ë°”ëŠ˜"}, {k: "å™¨", h: "ã†ã¤ã‚", p: "ìš°ì¸ ì™€", m: "ê·¸ë¦‡"},
        {k: "ç®¸", h: "ã¯ã—", p: "í•˜ì‹œ", m: "ì “ê°€ë½"}, {k: "å¼“", h: "ã‚†ã¿", p: "ìœ ë¯¸", m: "í™œ"}, {k: "ç¬›", h: "ãµãˆ", p: "í›„ì—", m: "í”¼ë¦¬"},
        {k: "ç›¾", h: "ãŸã¦", p: "íƒ€í…Œ", m: "ë°©íŒ¨"}, {k: "æ——", h: "ã¯ãŸ", p: "í•˜íƒ€", m: "ê¹ƒë°œ"},
        {k: "é›·", h: "ã‹ã¿ãªã‚Š", p: "ì¹´ë¯¸ë‚˜ë¦¬", m: "ë²ˆê°œ"}, {k: "éœ§", h: "ãã‚Š", p: "í‚¤ë¦¬", m: "ì•ˆê°œ"}, {k: "åµ", h: "ã‚ã‚‰ã—", p: "ì•„ë¼ì‹œ", m: "í­í’"},
        {k: "æ½®", h: "ã—ãŠ", p: "ì‹œì˜¤", m: "ì¡°ìˆ˜"}, {k: "æ»", h: "ãŸã", p: "íƒ€í‚¤", m: "í­í¬"},
        {k: "æ²¼", h: "ã¬ã¾", p: "ëˆ„ë§ˆ", m: "ëŠª"}, {k: "å‚", h: "ã•ã‹", p: "ì‚¬ì¹´", m: "ì–¸ë•/ê³ ê°œ"}
    ];

    let currentQuizSet = [], currentIdx = 0, correctCount = 0, failedQuestions = [], isReviewMode = false;

    // [ê°•ë ¥í•œ íˆë¼ê°€ë‚˜ ì „ìš© í•„í„°] í•œê¸€ ìœ ì…ì„ ì›ì²œ ì°¨ë‹¨í•©ë‹ˆë‹¤.
    function isOnlyJapanese(str) {
        return /^[ã-ã‚“ã‚¡-ãƒ¶ãƒ¼ä¸€-é¾¯]+$/.test(str);
    }

    // 3) ìŒì„± ê¸°ëŠ¥ ì¶”ê°€
    function speak(text) {
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = 'ja-JP';
        window.speechSynthesis.speak(utterance);
    }

    function startGame() {
        isReviewMode = false; failedQuestions = [];
        const safeData = kanjiData.filter(item => isOnlyJapanese(item.h));
        currentQuizSet = [...safeData].sort(() => Math.random() - 0.5).slice(0, 10);
        resetState();
    }

    function startRetryMode() {
        isReviewMode = true;
        currentQuizSet = [...failedQuestions].sort(() => Math.random() - 0.5);
        failedQuestions = []; 
        resetState();
    }

    function resetState() {
        currentIdx = 0; correctCount = 0;
        const indicator = document.getElementById('mode-indicator');
        indicator.innerText = isReviewMode ? "ë³µìŠµ ëª¨ë“œ ğŸ”" : "í•œì ë§ˆìŠ¤í„° ğŸ”¥";
        document.getElementById('quiz-screen').style.display = 'flex';
        document.getElementById('result-screen').style.display = 'none';
        hideFeedback();
        renderQuestion();
    }

    function hideFeedback() {
        document.getElementById('feedback').innerText = "";
        document.getElementById('next-btn').style.display = 'none';
    }

    function renderQuestion() {
        if (currentIdx >= currentQuizSet.length) { showResult(); return; }
        const q = currentQuizSet[currentIdx];
        
        document.getElementById('word-display').innerText = q.k;
        document.getElementById('current-q-num').innerText = currentIdx + 1;
        document.getElementById('correct-q-num').innerText = correctCount;

        let options = [q.h];
        let others = kanjiData.filter(item => item.h !== q.h && isOnlyJapanese(item.h)).sort(() => Math.random() - 0.5);
        
        while(options.length < 4 && others.length > 0) {
            let candidate = others.pop().h;
            if(!options.includes(candidate)) options.push(candidate);
        }
        options.sort(() => Math.random() - 0.5);

        const optionsDiv = document.getElementById('options');
        optionsDiv.innerHTML = "";
        options.forEach(opt => {
            const btn = document.createElement('button');
            btn.innerText = opt;
            btn.onclick = () => checkAnswer(opt, q);
            optionsDiv.appendChild(btn);
        });
    }

    function checkAnswer(selected, qObj) {
        const allBtns = document.querySelectorAll('#options button');
        allBtns.forEach(b => b.disabled = true);
        
        const feedback = document.getElementById('feedback');
        const nextBtn = document.getElementById('next-btn');

        // ë°œìŒ ì½ì–´ì£¼ê¸°
        speak(qObj.h);

        if (selected === qObj.h) {
            feedback.innerHTML = `<span class="correct">ë§ìŠµë‹ˆë‹¤! '${qObj.p}'ë¼ê³  ì½ìœ¼ë©°<br>ëœ»ì€ '${qObj.m}'ì…ë‹ˆë‹¤! âœ¨</span>`;
            correctCount++;
        } else {
            feedback.innerHTML = `<span class="incorrect">ì•„ì‰¬ì›Œìš”! ì •ë‹µì€ '${qObj.p}'(${qObj.h})ì…ë‹ˆë‹¤.<br>ëœ»ì€ '${qObj.m}'ì´ì—ìš”! ğŸŒ¸</span>`;
            if (!failedQuestions.some(item => item.k === qObj.k)) failedQuestions.push(qObj);
        }
        
        nextBtn.style.display = 'block';
    }

    function goToNextQuestion() {
        currentIdx++;
        hideFeedback();
        renderQuestion();
    }

    function showResult() {
        document.getElementById('quiz-screen').style.display = 'none';
        document.getElementById('result-screen').style.display = 'flex';
        document.getElementById('result-stats').innerText = `${currentQuizSet.length}ë¬¸ì œ ì¤‘ ${correctCount}ê°œ ì„±ê³µ!`;
        
        const retryBtn = document.getElementById('retry-failed-btn');
        if (failedQuestions.length > 0) {
            retryBtn.classList.remove('hidden');
        } else {
            retryBtn.classList.add('hidden');
        }
    }

    window.onload = startGame;
</script>
</body>
</html>
